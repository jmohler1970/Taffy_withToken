# Taffy for REST: Part 6 CAPTCHA

We now bring in another part of of the security model: CAPTCHA

# CAPTCHA 

Let's start with a defintion from Stackoverflow:

> A CAPTCHA or Captcha is a type of challenge-response test used in computing as an attempt to ensure that the response is not generated by a computer. The process usually involves one computer (a server) asking a user to complete a simple test which the computer is able to generate and grade.

I amare going to create a CAPTCHA web service. It will have one endpoint with two VERBS

- `/login/captcha` GET
- `/login/captcha` POST

GET will be used to generate the CAPTCHA
POST will be used to debug it. This test will be separate from the login process. 

## `resources/captcha.cfc`

Let's take a look at `resources/captcha.cfc`

Jumping to line 7. We are going to pick up a string that we are going to slice and dice into a nice new string by the time we get to line 12. I could have used `CreateUUID()`, but I tired of looking at mostly numbers. The configuration for the seed string and how it will be sliced is in `config.json`. Unlike APIkey, this can be changed without breaking anything.

Let's get into a little of of programming design here. Normally when we see an image on a web page, we know that there is a JPEG, PNG, or heaven forbid, a GIF image on a server that is being accessed via a publicly exposed file system. These image can exist on a server indefinitely. I am sure there is an image called `1x1.gif` out there that is more than 20 years old. 20 years from now it will probably still be served.

CAPTCHA images are very different though. Ideally will never be served more than once. I don't want to park such an image in anything resembling permanent. I want to make it and get rid of it. REST web services have a similar issue. Everytime a request is done. It is done. There is no clean way to say put an image on a server but only for as long as I needed.

We are not going to be saving an image to a file system. We are not going to returning an `src` to put into an image tag. We are going to push the image as a part of the response data.

And because we are going to push it over, we are going to use the ColdFusion ram drive.

What is a ram drive? It is a fake hard drive that exists in the a computer's physical memory. 

## Good parts of ram drives

- They are extremely fast
- They are automatically cleared out when a program is restarted
- They don't consume real hard drive space

## Not so good parts of ram drives
- Ram is much much more expensive than a real drive
- They are automatically cleared out when a program is restarted
- In the case of ColdFusion, it is consuming JVM space
- The memory it uses is shared across all applications.

Some of this is discussed in this Code Review (StackExchange) article.

https://codereview.stackexchange.com/questions/193131/creating-captcha-in-coldfusion-then-showing-image-in-vue-js

## Back to the code

Line 17 through 24 is where we 

- Make a temp file name
- `ImageCreateCaptcha()` creates the CAPTCHA image but does not save it.
- `ImageWriteBase64()` is going to save a text representation of the image. Let me repeat that more slowly. You might think that `#catcha#.txt` is the wrong name for an image. After all I just said I am saving an image. I am saving a text representation of an image. It can be later put into web pages. I will demo that later
- We use `FileRead()`. It is not `FileReadBinary()` but `FileRead()`.

On line 30, we send a hash represenation of the CAPTCHA string
On line 31, we send back a text representation of the CAPTCHA image 

At no point do we send back the raw CAPTCHA string.

I am going to skip over the POST verb. You might find it useful when debugging. Let's take a look at the CAPTCHA endpoint in action.





# Resources

- https://codereview.stackexchange.com/questions/193131/creating-captcha-in-coldfusion-then-showing-image-in-vue-js

- https://helpx.adobe.com/coldfusion/cfml-reference/coldfusion-functions/functions-h-im/imagecreatecaptcha.html

- https://helpx.adobe.com/coldfusion/cfml-reference/coldfusion-functions/functions-h-im/imagewritebase64.html

- https://www.bennadel.com/blog/1650-learning-coldfusion-9-the-virtual-file-system-ram-disk.htm

- https://stackoverflow.com/tags/captcha/info

- https://github.com/jmohler1970/Taffy_withUI (We haven't gotten to the UI part, but we will get there)